{% extends "cTools_common.html" %}

{% block customCSS %}
    td {
        border: solid;
        /*
        border-collapse: separate;
        border-spacing: 5px;
        */
        padding: 1em;
    }
{% endblock %}


{% block formName %}Edit Menu{% endblock %}
{% block tTitle %}{{ menuName }}{% endblock %}
<!-- menu head -->
{% block Hdr_LogoFormNameUserName %}
<div class="row max-width=100%">
    <div class="col-2 text-start"></div>
    <div class="col-8 text-center">
        <h5>
        Menu Group <select id="menuGroup" onchange="loadNewMenu(true);">
        {% for ch in menuGoto.menuGroup_choices %}
            <option value="{{ ch.id }}"
            {% if ch.id == menuGoto.menuGroup %}  selected {% endif %}
            >{{ ch }}</option>"
        {% endfor %}
        </select>  <small>{{ menuGoto.menuGroup }}</small>
        <br>
        Menu <select id="menuID" onchange="loadNewMenu(false);">
        {% for ch in menuGoto.menuID_choices %}
            <option value="{{ ch.MenuID }}"
            {% if ch.MenuID == menuGoto.menuID %}  selected {% endif %}
            >{{ ch }}</option>"
        {% endfor %}
        </select>
        </h5>
    </div>
    <div class="col-2 text-end">{{ current_user.username }}</div>
</div>
<div class="row max-width=100%">
    <div class="col-1 text-start"></div>
    <div class="col-8 text-center">
        GroupName: {{ form.menu_group.GroupName() }}
        GroupInfo: {{ form.menu_group.GroupInfo() }}
        MenuName:  <input type="text" name="menuName" form="menueditForm" value="{{ menuName }}" size="15">
    </div>
    <div class="col-2">
        <button type="button" id="CopyMenu">Copy Menu</button>
        <button type="button" id="NewMenu">New Menu</button>
        <button type="button" id="RemvMenu">Remv Menu</button>
    </div>
</div>
{% endblock %}
{% block statusMsgs %}
    {% if changed_data %}
        <div class="alert alert-success p-0 alert-dismissible fade show">
            <button type="button" class="btn-close p-0" data-bs-dismiss="alert"></button>
            Changes successfully saved.
            ChDat: {{ changed_data }}
        </div>
    {% endif %}
{% endblock %}
{% block boddy %}
<form method="POST" id="menueditForm">
    {{ form.hidden_tag() }}
    
    <table class="container">
        {% for i in range(10) %}
        {% set mItem_i = form.menu_items[i].form %}
        {% set mItem_i10 = form.menu_items[i+10].form %}
        <tr>
            <td>
                <span class='row'>
                    {{ mItem_i.OptionNumber.data }}
                    {% if mItem_i.id.data is not none %}(id {{ mItem_i.id.data }}){% endif %}
                    {{+ mItem_i.OptionText(style="width: 400px;") }}
                </span>
                <div class="row">
                    Command:  {{ mItem_i.Command(style="width: 150px;") }}
                    Argument: {{ mItem_i.Argument(style="width: 250px;") }}
                </div>
                {#
                fullMenuHTML += "<div class='row'>"
                fullMenuHTML += "<div class='col m-1'> Command: "
                fullMenuHTML += "<select style='width:10em' name='Command-" + istr + "'>"
                fullMenuHTML += commandchoiceHTML(mnItem_list[i_0based]['Command'])
                fullMenuHTML += "</select>"
                fullMenuHTML += " Argument: <input type='text' size='20' name='Argument-" + istr + "'"
                if mnItem_list[i_0based]['Argument']: fullMenuHTML += " value = '" + mnItem_list[i_0based]['Argument'] + "'"
                fullMenuHTML += "></input>"
                fullMenuHTML += "</div>"
                #}
                <div class="row">
                    Copy, Move | Remove go here
                </div>
                {#
                fullMenuHTML += "<div class='row'>"
                fullMenuHTML += "<div class='col m-1'>"
                fullMenuHTML += " Copy<input type='radio' name='CopyTo-" + istr + "' value='copy'>"
                fullMenuHTML += " Move<input type='radio' name='CopyTo-" + istr + "' value='move'>"
                fullMenuHTML += " to <input type='text' name='CopyTarget-" + istr + "' size='5'>"
                fullMenuHTML += " | "
                fullMenuHTML += " Remove:<input type='checkbox' name='Remove-" + istr + "'>"
                fullMenuHTML += "</div>"
                #}
                {##}
            </td>
            <td>
                <span class='row'>
                    {{ mItem_i10.OptionNumber.data }}
                    {% if mItem_i10.id.data is not none %}(id {{ mItem_i10.id.data }}){% endif %}
                    {{+ mItem_i10.OptionText(style="width: 400px;") }}
                </span>
                <div class="row">
                    Command:  {{ mItem_i10.Command(style="width: 150px;") }}
                    Argument: {{ mItem_i10.Argument(style="width: 250px;") }}
                </div>
                {#
                fullMenuHTML += "<div class='col m-1'> " + i2str + " "
                fullMenuHTML += "<input type='text' size='20' name='OptionText-" + i2str + "'"
                if mnItem_list[i_0based+10]['OptionText']: fullMenuHTML += " value = '" + mnItem_list[i_0based+10]['OptionText'] + "'"
                fullMenuHTML += "></input></div>"
                fullMenuHTML += "</div>"
                #}
                {#
                fullMenuHTML += "<div class='col m-1'> Command: "
                fullMenuHTML += "<select style='width:10em' name='Command-" + i2str + "'>"
                fullMenuHTML += commandchoiceHTML(mnItem_list[i_0based+10]['Command'])
                fullMenuHTML += "</select>"
                fullMenuHTML += " Argument: <input type='text' size='20' name='Argument-" + i2str + "'"
                if mnItem_list[i_0based+10]['Argument']: fullMenuHTML += " value = '" + mnItem_list[i_0based+10]['Argument'] + "'"
                fullMenuHTML += "></input>"
                fullMenuHTML += "</div>"
                fullMenuHTML += "</div>"
                #}
                <div class="row">
                    Copy, Move | Remove go here
                {#
                fullMenuHTML += "<div class='col m-1'>"
                fullMenuHTML += " Copy<input type='radio' name='CopyTo-" + i2str + "' value='copy'>"
                fullMenuHTML += " Move<input type='radio' name='CopyTo-" + i2str + "' value='move'>"
                fullMenuHTML += " to <input type='text' name='CopyTarget-" + i2str + "' size='5'>"
                fullMenuHTML += " | "
                fullMenuHTML += " Remove: <input type='checkbox' name='Remove-" + i2str + "'>"
                fullMenuHTML += "</div>"
                fullMenuHTML += "</div>"
                if i<10:
                    fullMenuHTML += "<hr>"
                #}
                {##}
            </td>
        </tr>
        {% endfor %}
    </table>

    {#
    {{ form.submit() }} should I use this or button below?
    #}
    <!-- form footer -->
    <br>
    <div class="container">
        <div class="row mx-auto max-width=100%">
            <div class="col-4">
                <button id="save_btn" type="submit">
                    <img src="{{ url_for('static', filename='svg/poem-poetry-icon.svg') }}" width="20" height="20"></img>
                    Save changes
                </button>
            </div>
            <div class="col-6"></div>
            <div class="col">
                <button id="close_btn" type="button" onclick="window.close();">
                    <img src="{{ url_for('static', filename='svg/stop-road-sign-icon.svg') }}" width="20" height="20"></img>
                    Close Form
                </button>
            </div>
        </div>
    </div>

</form>

<!--
<div id="get-MenuID-dialog" title="New Menu Group/ID">
    <form>
        <fieldset>
            <label for="NewMnuGroup">Menu Group</label>
            <input type="number" name="NewMnuGroup" id="NewMnuGroup" class="text ui-widget-content ui-corner-all">
            <label for="NewMnuID">Menu ID</label>
            <input type="number" name="NewMnuID" id="NewMnuID" class="text ui-widget-content ui-corner-all">
            
            <!- Allow form submission with keyboard without duplicating the dialog button ->
            <!- <input type="submit" tabindex="-1" style="position:absolute; top:-1000px"> ->
        </fieldset>
    </form>
</div>
-->

<script>

    CopyORNew = ''

    $("#get-MenuID-dialog").dialog({
        autoOpen: false,
        closeOnEscape: false,
        modal: true,
        buttons: {
            "OK": function() {
                NewMenuID_chosen();
                $(this).dialog("close");
            },
            "Cancel":  function() {
                $(this).dialog("close");
            }
        }
    });
    /* 
    $("#get-MenuID-dialog").find( "form" ).on( "submit", function( event ) {
        event.preventDefault();
        NewMenuID_chosen();
    });
    */
   
    $("#yesno-dialog").dialog({
        autoOpen: false,
        closeOnEscape: false,
        modal: true,
        buttons: {
            "Yes": function() {
                yesno_chosen(true);
                $(this).dialog("close");
            },
            "No":  function() {
                yesno_chosen(false);
                $(this).dialog("close");
            }
        }
    });
    $("#yesno-dialog").find( "button" ).on( "click", function( event ) {
        // event.preventDefault();
        yesno_chosen();
        $("yesno-dialog").close()
    });

    function NewMenuID_chosen() {
        var newRec

        if (CopyORNew == 'copy') {
            newRec = "" {# "{% url 'MenuCreate' 'menuGroup' 'menuNum' 'fromGroup' 'fromMenu' %}" #}
        } else if (CopyORNew == 'new') {
            newRec = "" {# "{% url 'MenuCreate' 'menuGroup' 'menuNum' %}" #}
        } else {
            // something is wrong
        }
        newRec = newRec.replace('/menuGroup','/'+$('#NewMnuGroup').val())
        newRec = newRec.replace('/menuNum','/'+$('#NewMnuID').val())
        newRec = newRec.replace('/fromGroup','/'+$('#menuGroup').val())
        newRec = newRec.replace('/fromMenu','/'+$('#menuID').val())
        window.location = newRec;
    }

    function yesno_chosen(yesnoVal) {
        if (yesnoVal) {
            //OK, kill this menu
            newRec = "" {# "{% url 'MenuRemove' 'menuGroup' 'menuNum' %}" #}
            newRec = newRec.replace('/menuGroup','/'+$('#menuGroup').val())
            newRec = newRec.replace('/menuNum','/'+$('#menuID').val())
            window.location = newRec;

        } else {
            // nope, don't really wanna destroy this menu; carry on
        }
    }
  

    $("#CopyMenu").on("click", function() {
        CopyORNew = 'copy'
        $("#get-MenuID-dialog").dialog("open")
    });    

    $("#NewMenu").on("click", function() {
        CopyORNew = 'new'
        $("#get-MenuID-dialog").dialog("open")
    });    

    $("#RemvMenu").on("click", function() {
        // are you sure?
        $("#yesno-dialog-text").html("Are you <b>SURE</b> you want to remove this menu?")  // is there a way I can pass this to the dialog object?
        $("#yesno-dialog").dialog("open")
    });    

    function loadNewMenu(newGrp) {
        var newRec = "" {# "{% url 'EditMenu' 'mGrp' 'mItm' %}" #}
        newRec = newRec.replace('/mGrp','/'+$('#menuGroup').val())
        if (newGrp) {
            newRec = newRec.replace('/mItm','/0')
        } else {
            newRec = newRec.replace('/mItm','/'+$('#menuID').val())
        }
        window.location = newRec;
    }

    document.body.onbeforeunload = function() {
        document.getElementById("wait_spinner").style.display = "block";
    }

</script>

{% endblock %}